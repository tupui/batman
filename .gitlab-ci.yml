stages:
  - test
  - doc

nemo_testing:
  stage: test
  tags:
    - sshroy.spike.batman
  only:
    - master
    - develop
  script:
    - cd ../.
    - tar -cf batman_ci.tar batman
    - scp batman_ci.tar batman/CI_NEMO.sh roy@nemo:~/.
    - ssh roy@nemo 'sbatch --partition debug --job-name batci --nodes=1 --share CI_NEMO.sh'
    - sleep 1800
    - ssh roy@nemo 'cat slurm*'

pages:
  stage: doc
  tags:
    - sshroy.spike.batman
  script:
  - source activate bat_ci
  - python setup.py build_fortran
  - python setup.py install
  - cd doc
  - make html
  - rm -rf public/
  - mv _build/html/ public/
  - pip uninstall -y batman
  artifacts:
    paths:
      - public
  only:
    - master
    - develop
